<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<head>
    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="description" content="">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="keywords" content="">

 
<meta property="og:type" content="article"/>
<meta property="og:description" content=""/>
<meta property="og:title" content="Design Pattern : spf13.com"/>
<meta property="og:site_name" content="spf13 is Steve Francia"/>
<meta property="og:image" content="" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="" />
<meta property="og:image:height" content="" />
<meta property="og:url" content="http://zhash.github.io/tags/design-pattern/">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2016-03-28"/>
<meta property="article:modified_time" content="2016-03-28"/>





<meta name="twitter:card" content="summary">

<meta name="twitter:site" content="@spf13">
<meta name="twitter:title" content="Design Pattern : spf13.com">
<meta name="twitter:creator" content="@spf13">
<meta name="twitter:description" content="">
<meta name="twitter:image:src" content="">
<meta name="twitter:domain" content="spf13.com">



    <base href="http://zhash.github.io">
    <title> Design Pattern - merty </title>
    <link rel="canonical" href="http://zhash.github.io/tags/design-pattern/">
    <link href="http://zhash.github.io/tags/design-pattern/index.xml" rel="alternate" type="application/rss+xml" title="Design Pattern" />

    <link href='http://fonts.googleapis.com/css?family=Fjalla+One|Open+Sans:300' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/static/css/style.css">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
</head>

<body lang="en">
<header id="header">
    <figure>
      <a href="/" border=0 id="logolink"><div class="icon-spf13-3" id="logo"> </div></a>
    </figure>
    <div id="byline">by Merty</div>
    <nav id="nav">
            <ul id="mainnav">
            <li>
                <a href="/post/">
                <span class="icon"> <i aria-hidden="true" class="icon-quill"></i></span>
                <span> blog </span>
            </a>
            </li>
            <li>
            <a href="/project/">
                <span class="icon"> <i aria-hidden="true" class="icon-console"></i></span>
                <span> code </span>
            </a>
            </li>
            <li>
            <a href="/presentation/">
                <span class="icon"> <i aria-hidden="true" class="icon-stats"></i></span>
                <span> talks </span>
            </a>
            </li>
            <li>
            <a href="http://zhash.github.io/post">
                <span class="icon"> <i aria-hidden="true" class="icon-13"></i></span>
                <span> me </span>
            </a>
            </li>
        </ul>

            <ul id="social">
            
            <li id="follow">
                <span class="icon icon-rocket"> </span>
                <span class="title"> follow </span>
                <div class="dropdown follow">
                    <ul class="social">
                        
                        <li> <a href="http://github.com/zhash" target="_blank" title="GitHub" class="github"><span class="icon icon-github"></span>GitHub</a> </li>
                        
                    </ul>
                    
                </div>
            </li>
        </ul>

    </nav>
</header>


<section id="main">
  <div>
   <h1 id="title">Design Pattern</h1>
    
        <article class="post">
    <header>
      <h2><a href="http://zhash.github.io/post/embrace-change-with-vba-05/">用VBA编写拥抱变化的代码(五) </a> </h2>
      <div class="post-meta">Mon, Mar 28, 2016 -  Read in 1 Min </div>
    </header>

    Embrace Change 5 晚上,凉风习习,是个读书赏字的好时光. 我们不搞大块头,只简单的聊一点轻松的哈,把其中关键点出来,大家一看就明白的那种. 我们来看一下上一篇中改进后的Parts类,具体的所有代码我就不复制了,需要的看 前一篇,里面有一个方法total,相关代码如下： Function total() total = price * part.perimeter End Function 我们在上一篇中说到了,类要尽量的低耦合,知道的越多,重用就越困难. 我们看到该方法知道了part对象的perimeter方法,如果Parts类对part.perimeter的 引用是唯一的,那么这段代码没什么问题.但有的时候,现实总是残酷的, 考虑以下影响： 如果Parts类中还有其他方法大量引用了part.perimeter,那很明显 它不符合DRY原则,这种外部入侵的数据,它需要包裹、封装、约束, 这是我们在第一篇开始处理外部参数时就提出 的思路. 如果part对象所属的类更改了perimeter方法的名称,那么一开始就封 装了它,对Parts类的影响就非常小了. 如果total的计算方式改变了,要再乘以产品系数,而这个产品系数又 是一个复杂的算法,这样part.perimeter就会被嵌入到一个复杂的方 法里,对于Parts类与part对象所属的类又出现了纠缠不清的情况. 所以我们应当采取隔离措施!更改后的代码如下： Function total() total = price * perimeter End Function Function perimeter() perimeter = part.perimeter End Function 这样我们在Parts里面创建了 perimeter方法,把外来的 part.perimeter 方法 给隔离了,如果外来数据有变动,我们只需要改这一个地方就可以了. 同时total方法中也将对外部类方法的依赖关系给删除了,它不需要知道外部类有哪些方法. 当然还有其他一些方法也能达到同样的效果,我们有时间再聊哈. 这一篇就先到这了,小菜一碟,供大家品尝哈……
    <footer>
        <a href='http://zhash.github.io/post/embrace-change-with-vba-05/'><nobr>Read more →</nobr></a>
    </footer>
</article>

    
        <article class="post">
    <header>
      <h2><a href="http://zhash.github.io/post/embrace-change-with-vba-04/">用VBA编写拥抱变化的代码(四) </a> </h2>
      <div class="post-meta">Mon, Mar 28, 2016 -  Read in 2 Min </div>
    </header>

    Embrace Change 4 前面几篇中我们探讨了如何管理外来参数的问题,后面几篇,我们来看看如何跟其他的类合作：总的原则当然是低耦合啦. 在最初学习时,经常会冒出个想法,前辈们经常都说要低耦合,那干脆不耦合不行吗？ ——不要说我笨哈,这真是我的学习过程,答案公布如下,免得有人跟我一样纠结中： 不耦合就谈不上类的组合运用啦! 所以耦合是必须的,只是如何减少这种耦合度才是我们要考虑的! 那如何减少耦合度呢？——只知道应该知道的,不该知道的东西不要知道! 知道的太多,后果……你懂的!嘿嘿…… 扯了一篇的闲话,下面上重点,来看两个类： 零件（Parts类）: 它负责计算长方形零件（因为现有公司只生产长方形）的总价, 总价 = 单价 * 零件周长,当然还有其他功能,我们暂时忽略. Private pric Private leng Private wid Private rect As Rects Property Get length() length = leng End Property Property Get wide() wide = wid End Property Property Get price() price = pric End Property Function init(price, length, wide) pric = price leng = length wid = wide End Function Function total() Set rect = New Rects rect.init length, wide total = price * rect.perimeter End Function '其他功能方法…… 长方形零件（Rects） Private leng Private wid Property Get length() length = leng End Property Property Get wide() wide = wid End Property Function init(length, wide) leng = length wid = wide End Function Function perimeter() perimeter = (length + wide) * 2 End Function '…… 它们之间的合作是这样的： Dim o As New Parts Sub old_parts() o.init 2, 3, 4 &lsquo;单价,长,宽 o.total &lsquo;…… End Sub 这两个类,表面看上去似乎挺平常的,但其实暗藏杀机,我们后面一一分解,这篇分解不完,下篇继续分解.
    <footer>
        <a href='http://zhash.github.io/post/embrace-change-with-vba-04/'><nobr>Read more →</nobr></a>
    </footer>
</article>

    
        <article class="post">
    <header>
      <h2><a href="http://zhash.github.io/post/embrace-change-with-vba-03/">用VBA编写拥抱变化的代码(三) </a> </h2>
      <div class="post-meta">Mon, Mar 28, 2016 -  Read in 1 Min </div>
    </header>

    Embrace Change 3 前两篇中我们都提到了DRY原则,在这篇中,我们正式提出一个口号： 从今天起,面朝大海,春暖花开,旗帜鲜明全面推行单一职责原则! 不管是类还是方法,单一职责的思想都有着重要的意义. 我们这里讨论方法,对于方法我们尽量要能够用一句话来描述它的职责,它是干什么的. 我们来看一下第二篇中类里提到的一个方法： Function perimeter() For i = 1 To count perimeter = tall(i).length + tall(i).wide * 2 Next End Function 这个方法显然有两项职责：遍历传入的数据,并计算每一个长方形的类周长 什么叫类周长？——请看用VBA编写拥抱变化的代码(二)! 我们根据单一职责原则把它分解为两个方法,这种重构肯定会带来额外的负 担,但对于性能如有必要,可在以后加以改善,现在最主要的是编写易于更 改的代码重构后的代码如下： Function perimeters() For i = 1 To count perimeter tall(i) Next End Function Private Function perimeter(tall As Taller) perimeter = tall.length + tall.wide * 2 End Function 将这种迭代动作分离出来,是一种常见的很容易识别出来的多职责情形. 当然象上面这样简单的重构,其影响力是非常小的,但这种编码风格一旦形成, 累积起来对我们影响是非常巨大的. 具有单一职责的方法的优点： 使类高内聚,我们说类也应该是具有单一职责的,目的性强的,从哪里做起？就是从类中方法做起,每一个短小精悍的方法,对于类会起到一个净化的效果. 替代注释,单一职责的方法可读性好,可以避免大量的注释,这些陈腐的注释,我已见过许多,都是陷阱. 编码风格的传承,后续维护你代码的程序员会按照你的编码风格进行维护. 最重要的一点,毫无疑问这种单一职责的方法是易于修改,更易于拥抱变化的.
    <footer>
        <a href='http://zhash.github.io/post/embrace-change-with-vba-03/'><nobr>Read more →</nobr></a>
    </footer>
</article>

    
        <article class="post">
    <header>
      <h2><a href="http://zhash.github.io/post/embrace-change-with-vba-02/">用VBA编写拥抱变化的代码(二) </a> </h2>
      <div class="post-meta">Fri, Mar 25, 2016 -  Read in 1 Min </div>
    </header>

    Embrace Change 2 第一篇写了如何封装包裹传入的简单参数,小喽啰总是好解决的. 现在如果传入的是一个数组,我们应该如何处理？大部队来了…… 我们照样弄个长方体的类Cuboid Private ar Function init(crr) ar = crr End Function Property Get arr() arr = ar End Property Function perimeter() '计算一个长与两个宽的和 brr = arr For i = 1 To UBound(brr, 1) perimeter = brr(1, 1) + brr(i, 2) * 2 Next End Function '……其他大量索引该数组的方法 传入的参数是一系列长、宽的二维数组：arr = [{10,3;10,4;10,5}] 按第一篇的思路,我们把传入的数组用一个方法包裹封装起来了. 但arr这个方法仅仅是返回了这个数组,而使用它的方法,必须 了解数据的哪一部分位于这个数组的哪一个索引位置上. 方法perimeter不仅知道如何计算类周长&mdash;-周长是2个长2个宽,而类周长是1个长 2个宽&mdash;-它还清楚的知道在数组的什么地方可以找到长与宽的数据. 遍历数组时,长在第一个位置,宽在第二个位置,它依赖于数组的结构. 如果这个数组的结构变了,比如,长与宽的位置颠倒了,那么这个方法 就必须更改了,而其他引用该数组的方法也要进更改,这些方法是脆弱的. 它们明修栈道,暗渡陈仓,表面上说投降我们了,可背后捅了我们一刀,暗箭难防啊. 它们不符合DRY原则,长跟宽在哪个索引位置的信息不应该被多次复制,它们只应 该存在于一个地方,我们应该用一个方法把它们包裹起来. 修改后的类如下所示： Private Type Taller length As Long wide As Long End Type Private tall() As Taller Private count Function init(arr) tallify arr End Function Function perimeter() For i = 1 To count perimeter = tall(i).length + tall(i).wide * 2 Next End Function Private Function tallify(arr) As Variant '包裹传进来的数组参数 For i = 1 To UBound(arr, 1) ReDim Preserve tall(1 To i) tall(i).length = arr(i, 1) tall(i).wide = arr(i, 2) Next count = i - 1 End Function 上面的这个perimeter方法对那个传入数组的内部结构一无所知, 它所知道的都是我们可以控制.tallify这个方法只包含少量的几 句代码,只有它能理解传入的数组参数,大部队敌人来了又怎样,我 们派一个小分队就解决了!
    <footer>
        <a href='http://zhash.github.io/post/embrace-change-with-vba-02/'><nobr>Read more →</nobr></a>
    </footer>
</article>

    
        <article class="post">
    <header>
      <h2><a href="http://zhash.github.io/post/embrace-change-with-vba-01/">用VBA编写拥抱变化的代码(一) </a> </h2>
      <div class="post-meta">Fri, Mar 25, 2016 -  Read in 1 Min </div>
    </header>

    Embrace Change 1 毫无疑问,这样的标题出来,应该是基于类的,在个人认为基于模块的VBA代码, 就好象一个毫无基础的人,直接打开EXCEL在电子表格里乱图乱画一样(说这样 的话会不会被人拍砖？一家之言,不必当真哈),当然每个写VBA代码的人都是 这样过来的,我只在指出一条另外的路径供大家参考.同时唠叨一句,VBA的功 能还是很强大的,当然其性能有天然的缺点,但我们又不是用它来发射火箭,够用了. 先看一个小例子:长方体的类Cuboid 属性:底面积 高 private are private hig 方法:求体积与初始化方法 Function volume() volume = are * hig End Function Function init(area, high) are = area hig = high End Function 这是一个小巧的类,但有一些隐患在其中,我们是认为体积等于底面积*高, 底面积是基于我们初始化传入的参数,然后这参数在我们的类中被肆意的到处引用, 当然这个类只是举例,所以简化了这面积参数只用来求体积. 如果这个类中有一个长的属性, 从而有一个用面积参数来求宽的方法,基于此还有一个求周长的方法,甚至被引用到其他的类中作为接口&hellip; 可以想象如果我们传入的参数不是一个面积的概念,会怎样？ 所有基于它的方法都会出错,需要重新修改,因此它需要一个约束 要依赖行为,不依赖数据 每一个细小的行为都只能存在于一个地方,“避免重复”(DRY),OO中的这一说法是对这一思想的简捷描述. 类包含数据与行为,数据可以是任何内容(包括简单的字符串或数值或者复杂的数组), 访问类的数据有两种方法:直接引用或者将其包裹在访问器方法里. 我们应该总是将其包裹在访问器方法里,而不是直接引用这些变量,具体如下: Private are Private hig Property Get area() area = are End Property Property Get high() high = hig End Property Function volume() volume = area * high '这里用了访问器的方法,而不是直接引用类数据变量 End Function ...
    <footer>
        <a href='http://zhash.github.io/post/embrace-change-with-vba-01/'><nobr>Read more →</nobr></a>
    </footer>
</article>

    
        <article class="post">
    <header>
      <h2><a href="http://zhash.github.io/post/vba-design-pattern/">设计模式在Excel VBA 类中的基础应用 </a> </h2>
      <div class="post-meta">Thu, Mar 24, 2016 -  Read in 2 Min </div>
    </header>

    Design Pattern VBA 跟很多玩VBA朋友一样,对于VBA的类一直摸不着头脑,觉得它的应用貌似不如想象中的强大, 直到阅读了《设计模式》的相关书籍后,才有一点心得,分享如下,当然设计模式的思想概念 什么的不会再本文中展开叙述的. 同时关于VBA类的基础知识,这边也不赘述了,相关资料也 有许多. 看书的直接后果导致个人目前认为: 技术到最后,褪去华丽的技巧,剩下能闪烁的还是思想. Scene 个人在实际工作中运用最多的场景是:打开一个数据源,取出相关数据,根据不同的需求加工 整理后输出.针对上面的场景,我们来进行相关的设计,至于里面用到了哪种或哪些设计模式 大家有兴趣可以自行研究. 这里并非卖关子,只是想抛砖引玉,让大家保持好奇心,去深入了 解设计模式. 如果强行说要去弄类的各种属性,也只不过是把数据源中的各个标题字段搞一遍而已,貌似是 画蛇添足, 所以我一般不搞,直接就是上类的方法. DateSource 数据源的类型包括文本文件、excel文件、各种数据库(Access,Oracle,SqlServer&hellip;) 需要一个Open的方法来打开数据源,假定数据源是excel文件,OpenWorkBook() 数据源有时不只一个excel文件而是一批,需要一个数组存放数据源的名称,FileArray() 数据源需要一个存放路径,所以定义一个方法叫FolderPath() 打开数据源取完数后,我们要关闭数据源,CloseWorkbook() 通常还会定义一个方法用来释放程序过程中用到的对象FreeObj() Interface 根据以上的描述一个通用接口类的方法,基本上就都出来了,汇总如下: INormal 接口类的名称为:INormal Public Function OpenWorkbook() End Function Public Function FileArray() End Function Public Function CloseWorkbook() End Function Public Function FreeObj() End Function 以上有几点需要注意一下: 接口类的名称遵循惯例以I打头 接口中涉及的方法名称不要有下划线 据我的经验,如果接口方法名称中带下划线的话,在实现类中VBE不容易自动生成相关的实现方法名称 （这一点纯属个人经验,未经官方证实）. IChange INormal是打底的,还会需要另一个接口类, 这个接口类名称为IChange,具体包含以下方法: 打开数据源后,要取得相关的源数据,需要一个方法GetSource() 这些源数据取得后,要进行加工整理,定义一个方法TransSource() 加工整理完以后,要进行输出,所以定义一个方法FillSource() 整理如下: Public Function GetSource() End Function Public Function TransSource(Optional arr As Variant) End Function Public Function FillSource(Optional arr As Variant) End Function 至此两个接口类已设置完成 Object 现在来看实现类 Company 先建一个实现类,名称为Company,引用上面的两个接口 Implements INormal Implements IChange 首先实现接口类INormal的方法: Private Function INormal_OpenWorkbook() End Function Private Function INormal_FolderPath() End Function Private Function INormal_FileArray() End Function Private Function INormal_CloseWorkbook() End Function Private Function INormal_FreeObj() End Function 再实现IChange接口类的方法 Private Function IChange_GetSource() As Variant dim arr:dim brr() INormal_FolderPath arr = INormal_FileArray If IsArray(arr) Then For i = 0 To UBound(arr) INormal_OpenWorkbook arr(i) ...
    <footer>
        <a href='http://zhash.github.io/post/vba-design-pattern/'><nobr>Read more →</nobr></a>
    </footer>
</article>

    
  </div>
</section>

<aside id="meta"> </aside>

<footer>
    <div>
        <p>
            &copy; 2016 Merty.
        </p>
    </div>
</footer>
<script type="text/javascript">
    (function() {
        var j = function(a, b) {
            return window.getComputedStyle ? getComputedStyle(a).getPropertyValue(b) : a.currentStyle[b]
        };
        var k = function(a, b, c) {
            if (a.addEventListener) a.addEventListener(b, c, false);
            else a.attachEvent('on' + b, c)
        };
        var l = function(a, b) {
            for (key in b)
                if (b.hasOwnProperty(key)) a[key] = b[key];
            return a
        };
        window.fitText = function(d, e, f) {
            var g = l({
                'minFontSize': -1 / 0,
                'maxFontSize': 1 / 0
            }, f);
            var h = function(a) {
                var b = e || 1;
                var c = function() {
                    a.style.fontSize = Math.max(Math.min(a.clientWidth / (b * 10), parseFloat(g.maxFontSize)), parseFloat(g.minFontSize)) + 'px'
                };
                c();
                k(window, 'resize', c)
            };
            if (d.length)
                for (var i = 0; i < d.length; i++) h(d[i]);
            else h(d);
            return d
        }
    })();
    fitText(document.getElementById('title'), 1)
</script>
<script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-7131036-1', 'spf13.com');
    ga('require', 'linkid', 'linkid.js');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
</script>
</body>

</html>
